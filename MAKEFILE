# COMPILER SETTINGS
FORTRANCOMPILER = gfortran

# TOOLS AND OPTIONS
DELETE = rm -rf
PRINT = echo

# FILE DIRECTORIES
SOURCEDIR = mod
OBJECTDIR = mod

# FILE EXTENSIONS
SOURCEEXT = .f90
OBJECTEXT = .o
MODULEEXT = .mod

# DEPENDENT MODULES
CONSTANTS = constants
FUNCTIONS = functions

# EXECUTABLE FILE
EXECUTABLE = app.exe

# SOURCE, EXPECTED OBJECT AND MODULE FILES
SOURCEFILES = $(wildcard $(SOURCEDIR)/*$(SOURCEEXT))
OBJECTFILES = $(patsubst $(SOURCEDIR)/%$(SOURCEEXT), $(OBJECTDIR)/%$(OBJECTEXT), $(SOURCEFILES))
MODULEFILES = $(patsubst $(OBJECTDIR)/%$(OBJECTEXT), %$(MODULEEXT), $(OBJECTFILES))

# MAIN PROGRAM SOURCE AND EXPECTED OBJECT FILE
MAINSOURCEFILE = $(wildcard $(CURDIR)/*$(SOURCEEXT))
MAINOBJECTFILE = $(patsubst $(CURDIR)/%$(SOURCEEXT), %$(OBJECTEXT), $(MAINSOURCEFILE))

# APPLICATION EXECUTION
ALL: $(EXECUTABLE)
	$(EXECUTABLE)

# APPLICATION BUILDING
$(EXECUTABLE): $(OBJECTFILES) $(MAINOBJECTFILE)
	$(FORTRANCOMPILER) -o $@ $^

# DEPENDENCY BETWEEN TARGETS
$(MAINOBJECTFILE): $(OBJECTFILES)
$(OBJECTDIR)/$(FUNCTIONS)$(OBJECTEXT): $(OBJECTDIR)/$(CONSTANTS)$(OBJECTEXT)

# $(SOURCEDIR)/FILENAME.F90 --> $(OBJECTDIR)/FILENAME.O
$(OBJECTDIR)/%$(OBJECTEXT): $(SOURCEDIR)/%$(SOURCEEXT)
	$(FORTRANCOMPILER) -o $@ -c $<

# FILENAME.F90 --> FILENAME.O
%$(OBJECTEXT): %$(SOURCEEXT)
	$(FORTRANCOMPILER) -o $@ -c $<

# DELETE GENERATED OBJECT AND MODULE FILES
CLEAN:
	@$(DELETE) $(OBJECTFILES) $(MAINOBJECTFILE) $(MODULEFILES) $(EXECUTABLE)

# PRINT SOURCE, GENERATED OBJECT AND MODULE FILES
DEBUG:
	@$(PRINT) SOURCEFILES: $(SOURCEFILES)
	@$(PRINT) OBJECTFILES: $(OBJECTFILES)
	@$(PRINT) MODULEFILES: $(MODULEFILES)
	@$(PRINT) MAINSOURCEFILE: $(MAINSOURCEFILE)
	@$(PRINT) MAINOBJECTFILE: $(MAINOBJECTFILE)

# PLOT GRAPHS
PLOT:
	python plotter/plotter.py

# SPECIFY TARGETS THAT ARE NOT FILES
.PHONY: CLEAN DEBUG PLOT
